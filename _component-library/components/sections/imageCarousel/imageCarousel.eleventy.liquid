{% assign color_group = styles.color_group %}
{% assign outerTrack = "glide-" | uuidFilter | replace: "-", "" %}
{% assign outerTrackMobile = "glide-" | uuidFilter | replace: "-", "" %}
{% assign lightBoxId = "lightbox" | uuidFilter | replace: "-", "" %}
{% assign imagelist = content.images %}
{% assign imageCounter = content.images.size %}
{% unless env_bookshop_live %}
{% assign imageCounter = 0 %}
{%- capture imageList -%}
    {% for image in content.images %}
    - imagePath: {{image.imagePath}}
      imageAlt: {{image.imageAlt}}
      yAxisPosition: {{image.yAxisPosition}}
      imageNumber: {{imageCounter}}
      {% assign imageCounter = imageCounter | plus: 1 %} 
    {% endfor %}
{%- endcapture -%}
{% assign imageList = imageList | ymlify %}
{% endunless %}
{% assign firstImage = imageList[0] %}
{% assign remainingImages = imageList | slice: 1, imageList.size %}
{% capture imageClasses %}
  w-full h-full object-cover object-center {{theme.image_rounding}}
  {% endcapture %}
{% assign modValue = 4 %}

{% capture gridClasses %}
 {% if imageCounter >= 43 %}
{% assign modValue = 9 %}
md:grid-cols-3 md:grid-rows-3
 {% elsif imageCounter >= 25 %}
  {% assign modValue = 6 %}
  md:grid-cols-2 md:grid-rows-3
  {% else %}
     {% assign modValue = 4 %}
     md:grid-cols-2 md:grid-rows-2
 {% endif %} 
{% endcapture %}
<div class="c-imageCarousel relative">
  <section class="basecontainer w-full">

    {% if content.sectionId %}
      {% bookshop "util/IdScrollEvent" sectionId: content.sectionId %}
    {% endif %}

    {% if content.heading %}
      {% bookshop {{content.heading._bookshop_name}} bind: content.heading %}
    {% endif %}

    <div class=" cs-w-full relative flex bg-{{styles.color_group}}-backgroundcolor h-[50vh] md:h-[70vh]">
      <div class="absolute top-[97%] left-[48%] bg-{{styles.color_group}}-backgroundcolor text-base p-2 {{theme.container_rounding}} text-{{styles.color_group}}-textcolor z-10">{{imageCounter}} Photos</div>
      <div class="hidden md:block {{outerTrack}} w-full">
        <div class="glide__track h-full" data-glide-el="track">
          <ul class="glide__slides flex h-full">

            <li class="glide__slide w-1/2 {{theme.container_rounding}} h-full border-4 border-{{styles.color_group}}-secondarycolor">
              <button _="
      on click
      set modal to #modal-{{lightBoxId}}
      modal.show()
      transition #modal-{{lightBoxId}} opacity to 1 over 0.2s
      ">{% bookshop "generic/image" bind: firstImage class: imageClasses %}</button>
            </li>

            {% assign groupIndex = 0 %}
            {% assign imageGroup = "" %}
            {% for image in remainingImages %}
              {% assign groupMod = forloop.index0 | modulo: modValue %}
              {% if groupMod == 0 %}
                {% if forloop.index0 > 0 %}
                  </div></li>
                {% endif %}
                <li class="glide__slide {{theme.container_rounding}} w-1/2 h-full border-4 border-{{styles.color_group}}-secondarycolor">
                  <div class="grid grid-cols-1 grid-rows-1 {{gridClasses}} gap-1 h-full">
              {% endif %}

              <button class="w-full h-full {{theme.container_rounding}}"
              _="
      on click
      set modal to #modal-{{lightBoxId}}
      modal.show()
      transition #modal-{{lightBoxId}} opacity to 1 over 0.2s
      "
              >
                {% bookshop "generic/image" bind: image class: imageClasses %}
              </button>

              {% if forloop.last %}
                  </div></li>
              {% endif %}
            {% endfor %}

          </ul>
        </div>
      </div>
      <div class="md:hidden {{outerTrackMobile}} w-full">
        <div class="glide__track h-full" data-glide-el="track">
          <ul class="glide__slides flex h-full">

 {% for image in imageList %}
    <li class="glide__slide w-full h-full border-4 border-{{styles.color_group}}-secondarycolor {{theme.container_rounding}}">
      <button _=
      "
      on click
      set modal to #modal-{{lightBoxId}}
      modal.show()
      transition #modal-{{lightBoxId}} opacity to 1 over 0.2s
      ">
        
      {% bookshop "generic/image" bind: image class: imageClasses %}</button>
    </li>
  {% endfor %}
          </ul>
        </div>
      </div>
    </div>

    <script src="/assets/js/glide.js"></script>
    <script>
      new Glide('.{{ outerTrack }}', {
  type: 'carousel',
  perView: 2,
  gap: 0,
  breakpoints: {
    768: {
      perView: 1
    }
  }
}).mount();
      new Glide('.{{ outerTrackMobile }}', {
  type: 'carousel',
  perView: 2,
  gap: 0,
  breakpoints: {
    768: {
      perView: 1
    },
  peek:{
    before: 0,
    after: 25
  }
  }
}).mount();
    </script>
  </section>
</div>

{% bookshop "generic/lightBox" images: imageList id: lightBoxId %}
